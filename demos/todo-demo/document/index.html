<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title></title>
</head>
<body>

    <script src="../../shared/loading.js"></script>

    <template id="todo-item">
        ${<script>
            // to inject css content to header element as style tag use:
            // this.template.css("$text!demos/shared/css/todo-item.css")
            this.template.css("/demos/shared/css/todo-item.css")
        </script>}
        
        <div class="ToDoItem" id="item">
            <p class="ToDoItem-Text">${this.dataIndex + ". " + this.html}</p>
            <div class="ToDoItem-Delete" onclick="deleteClick">-</div>
        </div>

        ${<script>
            () => {
                this.template.context = {
                    deleteClick: () => {
                        this.template.parent.count--;
                        this.template.model.item.remove();
                    }
                };
                this.template.id = value => {
                    this.id = value;
                    console.log("id atrribute set to " + value);
                };
                this.template.dataIndex = value => {
                    this.dataIndex = value;
                    console.log("dataIndex atrribute set to " + value);
                };
            }
        </script>}
    </template>

    <template>
        ${<script>
            // to inject css content to header element as style tag use:
            // this.template.css("$text!demos/shared/css/todo.css")
            this.template.css("/demos/shared/css/todo.css")
        </script>}
        ${
        <script>
            (
                () => {
                    // define custom component
                    _app.customElements.define({tag: "todo-item", src: "$template!todo-item"});

                    this.template.context = {
                        input: "initial value",
                        createNewToDoItem: () => this.template.model.content.insertAdjacentHTML(
                            "beforeend",
                            `<todo-item data-index="${++this.count}">${this.template.model.input.value}</todo-item>`
                        )
                    }
                }
            )()
        </script>
        }
        
        <div class="ToDo">
            <h1 class="ToDo-Header">ihjs To Do demo</h1>
            <div class="ToDo-Container">
                <div class="ToDo-Content" id="content">
                    ${<script>
                        async () => this.template.forEach(await _app.fetch("/demos/shared/todo.json"), (item, index) => 
                        `
                            <todo-item id="${'todo-item-' + index}" data-index="${this.count = index+1}">${item}</todo-item>
                        `
                        )
                    </script>}
                </div>
                <input type="text" id="input" />
                <div class="ToDo-Add" onclick="createNewToDoItem">+</div>
            </div>
        </div>
        ${<script>
            /*
            * if we don't return function first `() => `, anything the is evaluated at this event assignment will be rendered and in this vase it is `undefined`
            */
            () => this.template.rendered = () => {
                console.log("Main template have following components: ");
                console.log(this.template.children);
                console.log("Change some attribute value on todo-item element...");
            }
        </script>}
    </template>

    <!-- <script type="module" src="../../../src/ihjs/dev/ihjs.js"></script> -->
    <script type="module" src="../../../src/ihjs/build/1.0.6/ihjs.js"></script>

</body>
</html>
